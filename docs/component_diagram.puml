@startuml Component Diagram
!theme plain
skinparam componentStyle rectangle
skinparam linetype ortho

title ApplyCrypto 컴포넌트 다이어그램

package "CLI Layer" {
  component [CLI Controller] as CLI
}

package "Configuration Layer" {
  component [Config Manager] as Config
}

package "Collection Layer" {
  component [Source File Collector] as Collector
}

package "Parsing Layer" {
  component [Java AST Parser] as JavaParser
  component [XML Mapper Parser] as XMLParser
  component [Call Graph Builder] as CallGraph
  component [Endpoint Extraction Strategy] as EndpointStrategy
  component [Spring MVC Endpoint Extraction] as SpringMVC
  component [Anyframe SarangOn Endpoint Extraction] as AnyframeEndpoint
}

package "Analysis Layer" {
  component [DB Access Analyzer] as DBAnalyzer
  component [SQL Extractor] as SQLExtractor
  component [MyBatis SQL Extractor] as MyBatisExtractor
  component [JDBC SQL Extractor] as JDBCExtractor
  component [JPA SQL Extractor] as JPAExtractor
  component [Anyframe JDBC SQL Extractor] as AnyframeExtractor
  component [SQL Extractor Factory] as SQLExtractorFactory
}

package "Modification Layer" {
  component [Code Modifier] as CodeModifier
  component [Code Generator] as CodeGenerator
  component [Controller/Service Code Generator] as ControllerServiceGen
  component [ServiceImpl/Biz Code Generator] as ServiceImplBizGen
  component [TypeHandler Code Generator] as TypeHandlerGen
  component [Code Generator Factory] as CodeGenFactory
  component [Context Generator] as ContextGen
  component [Batch Processor] as BatchProcessor
  component [Code Patcher] as CodePatcher
  component [Error Handler] as ErrorHandler
  component [Result Tracker] as ResultTracker
  component [Prompt Template Manager] as TemplateManager
}

package "LLM Layer" {
  component [LLM Factory] as LLMFactory
  component [LLM Provider Interface] as LLMProvider
  component [WatsonX Provider] as WatsonX
  component [OpenAI Provider] as OpenAI
  component [Claude AI Provider] as Claude
}

package "Persistence Layer" {
  component [Data Persistence Manager] as Persistence
  component [Cache Manager] as Cache
}

package "Models" {
  component [SourceFile] as SourceFileModel
  component [TableAccessInfo] as TableAccessModel
  component [Method] as MethodModel
  component [CallRelation] as CallRelationModel
  component [ModificationRecord] as ModRecordModel
  component [Endpoint] as EndpointModel
}

' CLI Layer 관계
CLI --> Config : uses
CLI --> Collector : uses
CLI --> JavaParser : uses
CLI --> XMLParser : uses
CLI --> CallGraph : uses
CLI --> DBAnalyzer : uses
CLI --> CodeModifier : uses
CLI --> Persistence : uses

' Collection Layer 관계
Collector --> Config : uses
Collector --> SourceFileModel : creates

' Parsing Layer 관계
JavaParser --> Cache : uses
JavaParser --> MethodModel : creates
JavaParser --> CallRelationModel : creates
XMLParser --> TableAccessModel : creates
CallGraph --> JavaParser : uses
CallGraph --> Cache : uses
CallGraph --> MethodModel : uses
CallGraph --> CallRelationModel : uses
CallGraph --> EndpointStrategy : uses
CallGraph --> EndpointModel : creates
EndpointStrategy <|-- SpringMVC : implements
EndpointStrategy <|-- AnyframeEndpoint : implements

' Analysis Layer 관계
DBAnalyzer --> Config : uses
DBAnalyzer --> XMLParser : uses
DBAnalyzer --> JavaParser : uses
DBAnalyzer --> CallGraph : uses
DBAnalyzer --> SQLExtractor : uses
DBAnalyzer --> TableAccessModel : creates
SQLExtractor <|-- MyBatisExtractor : implements
SQLExtractor <|-- JDBCExtractor : implements
SQLExtractor <|-- JPAExtractor : implements
SQLExtractor <|-- AnyframeExtractor : implements
SQLExtractorFactory --> SQLExtractor : creates
SQLExtractorFactory --> MyBatisExtractor : creates
SQLExtractorFactory --> JDBCExtractor : creates
SQLExtractorFactory --> JPAExtractor : creates
SQLExtractorFactory --> AnyframeExtractor : creates

' Modification Layer 관계
CodeModifier --> Config : uses
CodeModifier --> CodeGenerator : uses
CodeModifier --> CodePatcher : uses
CodeModifier --> ErrorHandler : uses
CodeModifier --> ResultTracker : uses
CodeModifier --> TableAccessModel : uses
CodeGenerator <|-- ControllerServiceGen : implements
CodeGenerator <|-- ServiceImplBizGen : implements
CodeGenerator <|-- TypeHandlerGen : implements
CodeGenFactory --> CodeGenerator : creates
CodeGenFactory --> ControllerServiceGen : creates
CodeGenFactory --> ServiceImplBizGen : creates
CodeGenFactory --> TypeHandlerGen : creates
ControllerServiceGen --> ContextGen : uses
ControllerServiceGen --> BatchProcessor : uses
ControllerServiceGen --> TemplateManager : uses
ControllerServiceGen --> LLMProvider : uses
BatchProcessor --> TemplateManager : uses
BatchProcessor --> LLMProvider : uses
CodePatcher --> ErrorHandler : uses
ResultTracker --> ModRecordModel : creates

' LLM Layer 관계
LLMFactory --> LLMProvider : creates
LLMFactory --> WatsonX : creates
LLMFactory --> OpenAI : creates
LLMFactory --> Claude : creates
WatsonX ..|> LLMProvider : implements
OpenAI ..|> LLMProvider : implements
Claude ..|> LLMProvider : implements

' Persistence Layer 관계
Persistence --> Cache : uses
Persistence --> SourceFileModel : serializes
Persistence --> TableAccessModel : serializes
Persistence --> MethodModel : serializes
Persistence --> CallRelationModel : serializes
Persistence --> ModRecordModel : serializes

note right of CLI
  CLI 진입점
  analyze, list, modify 명령어 처리
end note

note right of CodeModifier
  LLM을 활용한
  코드 자동 수정
end note

note right of DBAnalyzer
  DB 접근 패턴 분석
  Call Graph 역추적
end note

note right of SQLExtractor
  SQL 추출 전략 패턴
  MyBatis, JDBC, JPA, Anyframe 지원
end note

note right of EndpointStrategy
  엔드포인트 추출 전략
  Spring MVC, Anyframe SarangOn 지원
end note

@enduml
