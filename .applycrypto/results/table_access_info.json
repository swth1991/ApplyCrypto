[
  {
    "table_name": "tb_employee",
    "columns": [
      {
        "name": "day_of_birth",
        "new_column": false
      },
      {
        "name": "jumin_number",
        "new_column": false
      },
      {
        "name": "last_name",
        "new_column": false
      },
      {
        "name": "sex",
        "new_column": false
      }
    ],
    "access_files": [
      "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/beans/Employee.java",
      "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/controller/EmpController.java",
      "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/controller/EmployeeController.java",
      "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/dao/EmployeeMapper.java",
      "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/service/EmployeeService.java"
    ],
    "query_type": "SELECT",
    "sql_query": "select e.id id,e.last_name last_name,e.sex sex, e.email email, e.day_of_birth day_of_birth, e.jumin_number jumin_number,\n e.dept_id d_id,d.id did,d.dept_name dept_name from\n tb_employee e,tb_department d where e.dept_id = d.id",
    "layer": "Controller",
    "sql_queries": [
      {
        "id": "getEmps",
        "query_type": "SELECT",
        "sql": "select e.id id,e.last_name last_name,e.sex sex, e.email email, e.day_of_birth day_of_birth, e.jumin_number jumin_number,\n e.dept_id d_id,d.id did,d.dept_name dept_name from\n tb_employee e,tb_department d where e.dept_id = d.id",
        "parameter_type": null,
        "result_type": "com.mybatis.beans.Employee",
        "result_map": "MyDifEmp",
        "namespace": "com.mybatis.dao.EmployeeMapper"
      },
      {
        "id": "query",
        "query_type": "SELECT",
        "sql": "select e.id id,e.last_name last_name,e.sex sex, e.email email, e.day_of_birth day_of_birth, e.jumin_number jumin_number,\n e.dept_id d_id,d.id did,d.dept_name dept_name from\n tb_employee e left join tb_department d on  e.dept_id = d.id  where CONCAT(e.id, last_name, sex, email, e.day_of_birth, e.jumin_number, e.dept_id, d.id, d.dept_name)  like #{condition}",
        "parameter_type": null,
        "result_type": "com.mybatis.beans.Employee",
        "result_map": "conditionEmp",
        "namespace": "com.mybatis.dao.EmployeeMapper"
      },
      {
        "id": "getEmpsByPage",
        "query_type": "SELECT",
        "sql": "select e.id id,e.last_name last_name,e.sex sex, e.email email, e.day_of_birth day_of_birth, e.jumin_number jumin_number,\n e.dept_id d_id,d.id did,d.dept_name dept_name from\n tb_employee e,tb_department d where e.dept_id = d.id limit #{param1} , #{param2}",
        "parameter_type": null,
        "result_type": "com.mybatis.beans.Employee",
        "result_map": "pageEmp",
        "namespace": "com.mybatis.dao.EmployeeMapper"
      },
      {
        "id": "getEmpById",
        "query_type": "SELECT",
        "sql": "select id, last_name lastName, sex, email, day_of_birth dayOfBirth, jumin_number juminNumber  from tb_employee where id = #{id}",
        "parameter_type": null,
        "result_type": "com.mybatis.beans.Employee",
        "result_map": null,
        "namespace": "com.mybatis.dao.EmployeeMapper"
      },
      {
        "id": "addEmp",
        "query_type": "INSERT",
        "sql": "insert into tb_employee(last_name,email,sex,day_of_birth,jumin_number,dept_id) values(#{lastName},#{email},#{sex},#{dayOfBirth},#{juminNumber},#{dept.id})",
        "parameter_type": "com.mybatis.beans.Employee",
        "result_type": null,
        "result_map": null,
        "namespace": "com.mybatis.dao.EmployeeMapper"
      },
      {
        "id": "updateEmp",
        "query_type": "UPDATE",
        "sql": "update tb_employee set last_name=#{lastName},email=#{email},sex=#{sex},day_of_birth=#{dayOfBirth},jumin_number=#{juminNumber},dept_id=#{dept.id} where id=#{id}",
        "parameter_type": null,
        "result_type": null,
        "result_map": null,
        "namespace": "com.mybatis.dao.EmployeeMapper"
      }
    ],
    "layer_files": {
      "interface": [
        "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/dao/EmployeeMapper.java"
      ],
      "dao": [
        "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/beans/Employee.java"
      ],
      "service": [
        "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/service/EmployeeService.java"
      ],
      "controller": [
        "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/controller/EmpController.java",
        "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/controller/EmployeeController.java"
      ]
    },
    "modified_files": [
      {
        "file_path": "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/dao/EmployeeMapper.java",
        "layer": "interface",
        "modification_type": "encryption",
        "status": "skipped",
        "timestamp": "2025-11-28T14:48:50.974119",
        "tokens_used": 2182,
        "error": "This is an interface file and does not contain implementation logic, so no modifications for encryption/decryption are needed."
      },
      {
        "file_path": "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/beans/Employee.java",
        "layer": "dao",
        "modification_type": "encryption",
        "status": "skipped",
        "timestamp": "2025-11-28T14:49:01.306862",
        "tokens_used": 2820,
        "error": "This is a model class and doesn't contain business logic for saving/loading data. Modifications should be made in service or DAO classes that process this object."
      },
      {
        "file_path": "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/service/EmployeeService.java",
        "layer": "service",
        "modification_type": "encryption",
        "status": "success",
        "timestamp": "2025-11-28T14:50:58.183512",
        "tokens_used": 5551,
        "diff": "--- a/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/service/EmployeeService.java\n+++ b/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/service/EmployeeService.java\n@@ -2,6 +2,7 @@\n \n import java.util.List;\n import java.util.Map;\n+import com.mybatis.beans.User;\n \n import com.mybatis.beans.User;\n import org.springframework.beans.factory.annotation.Autowired;\n@@ -23,6 +24,12 @@\n \n @Service\n public class EmployeeService {\n+    // Constants for encryption\n+    private static final String K_SIGN_NAME = k_sign.CryptoService.K_SIGN_NAME;\n+    private static final String K_SIGN_JUMIN = k_sign.CryptoService.K_SIGN_JUMIN;\n+    private static final String K_SIGN_GENDER = k_sign.CryptoService.K_SIGN_GENDER;\n+    private static final String K_SIGN_DOB = k_sign.CryptoService.K_SIGN_DOB;\n+\n \t@Autowired\n \tprivate EmployeeMapper employeeMapper;\n \n@@ -31,7 +38,12 @@\n \t\n \tpublic List<Employee> getEmps(){\n \t\tList<Employee> employees = employeeMapper.getEmps();\n+\t\tfor (Employee employee : employees) {\n+\t\t\tif (employee.getJuminNumber() != null) {\n+\t\t\t\temployee.setJuminNumber(k_sign.CryptoService.decrypt(employee.getJuminNumber(), K_SIGN_JUMIN));\n+\t\t\t}\n \t\t\tif (employee.getUserName() != null) {\n \t\t\t\temployee.setUserName(k_sign.CryptoService.decrypt(employee.getUserName(), K_SIGN_NAME));\n \t\t\t}\n@@ -40,10 +52,21 @@\n \t\t\t\temployee.setSex(k_sign.CryptoService.decrypt(employee.getSex(), K_SIGN_GENDER));\n \t\t\t}\n \t\t\tif (employee.getDob() != null) {\n-\t\t\t\temployee.setDob((String)k_sign.CryptoService.decrypt((String)employee.getDob(), K_SIGN_DOB));\n+\t\t\t\temployee.setDob(k_sign.CryptoService.decrypt(employee.getDob(), K_SIGN_DOB));\n \t\t\t}\n \t\t}\n \t\treturn employees;\n \t}\n+\n+\tpublic void delete(Integer id) {\n+\t\t// TODO Auto-generated method stub\n+\t\temployeeMapper.deleteEmpById(id);\n+\t\n+\t}\n+\n+\tpublic void update(Employee employee)\n+\t{\n+\t\tif (employee.getJuminNumber() != null) {\n \t\temployee.setJuminNumber(k_sign.CryptoService.encrypt(employee.getJuminNumber(), K_SIGN_JUMIN));\n+\t\t}\n \t\tif (employee.getUserName() != null) {\n \t\t\temployee.setUserName(k_sign.CryptoService.encrypt(employee.getUserName(), K_SIGN_NAME));\n@@ -53,14 +76,20 @@\n \t\t\temployee.setSex(k_sign.CryptoService.encrypt(employee.getSex(), K_SIGN_GENDER));\n \t\t}\n \t\tif (employee.getDob() != null) {\n-\t\t\temployee.setDob((String)k_sign.CryptoService.encrypt((String)employee.getDob(), K_SIGN_DOB));\n+\t\t\temployee.setDob(k_sign.CryptoService.encrypt(employee.getDob(), K_SIGN_DOB));\n \t\t}\n-\t\temployeeMapper.updateEmp(employee);\n+\t\temployeeMapper.updateEmp(employee);\n+\t}\n+\n+\tpublic void save(Employee employee) {\n+\t\t// TODO Auto-generated method stub\n+\t\tDepartment dept = deptMapper.getDeptById(employee.getDept().getId());\n+\t\temployee.setDept(dept);\n+\t\tif (employee.getJuminNumber() != null) {\n \t\temployee.setJuminNumber(k_sign.CryptoService.encrypt(employee.getJuminNumber(), K_SIGN_JUMIN));\n+\t\t}\n+\t\tif (employee.getUserName() != null) {\n+\t\t\temployee.setUserName(k_sign.CryptoService.encrypt(employee.getUserName(), K_SIGN_NAME));\n+\t\t}\n \t\tif (employee.getName() != null) {\n \t\t\temployee.setName(k_sign.CryptoService.encrypt(employee.getName(), K_SIGN_NAME));\n@@ -69,10 +98,16 @@\n \t\t\temployee.setSex(k_sign.CryptoService.encrypt(employee.getSex(), K_SIGN_GENDER));\n \t\t}\n \t\tif (employee.getDob() != null) {\n-\t\t\temployee.setDob((String)k_sign.CryptoService.encrypt((String)employee.getDob(), K_SIGN_DOB));\n+\t\t\temployee.setDob(k_sign.CryptoService.encrypt(employee.getDob(), K_SIGN_DOB));\n \t\t}\n \t\temployeeMapper.addEmp(employee);\n \n+\t}\n+\n+\tpublic Employee getEmpById(Integer id) {\n+\t\tEmployee employee = employeeMapper.getEmpById(id);\n+\t\tif (employee.getJuminNumber() != null) {\n \t\temployee.setJuminNumber(k_sign.CryptoService.decrypt(employee.getJuminNumber(), K_SIGN_JUMIN));\n+\t\t}\n+\t\tif (employee.getUserName() != null) {\n+\t\t\temployee.setUserName(k_sign.CryptoService.decrypt(employee.getUserName(), K_SIGN_NAME));\n@@ -82,16 +117,26 @@\n \t\t\temployee.setSex(k_sign.CryptoService.decrypt(employee.getSex(), K_SIGN_GENDER));\n \t\t}\n \t\tif (employee.getDob() != null) {\n-\t\t\temployee.setDob((String)k_sign.CryptoService.decrypt((String)employee.getDob(), K_SIGN_DOB));\n+\t\t\temployee.setDob(k_sign.CryptoService.decrypt(employee.getDob(), K_SIGN_DOB));\n \t\t}\n \t\treturn employee;\n \t}\n \n \tpublic List<Employee> getEmpsByPage(Integer pageIndex,Integer size) {\n \t\tList<Employee> employees = employeeMapper.getEmpsByPage(pageIndex,size);\n+\t\tfor (Employee employee : employees) {\n+\t\t\tif (employee.getJuminNumber() != null) {\n+\t\t\t\temployee.setJuminNumber(k_sign.CryptoService.decrypt(employee.getJuminNumber(), K_SIGN_JUMIN));\n+\t\t\t}\n+\t\t\tif (employee.getUserName() != null) {\n+\t\t\t\temployee.setUserName(k_sign.CryptoService.decrypt(employee.getUserName(), K_SIGN_NAME));\n+\t\t\t}\n+\t\t\tif (employee.getName() != null) {\n+\t\t\t\temployee.setName(k_sign.CryptoService.decrypt(employee.getName(), K_SIGN_NAME));\n+\t\t\t}\n \t\t\tif (employee.getSex() != null) {\n-\t\t\t\temployee.setSex((String)k_sign.CryptoService.decrypt((String)employee.getSex(), K_SIGN_GENDER));\n+\t\t\t\temployee.setSex(k_sign.CryptoService.decrypt(employee.getSex(), K_SIGN_GENDER));\n \t\t\t}\n \t\t\tif (employee.getDob() != null) {\n-\t\t\t\temployee.setDob((String)k_sign.CryptoService.decrypt((String)employee.getDob(), K_SIGN_DOB));\n+\t\t\t\temployee.setDob(k_sign.CryptoService.decrypt(employee.getDob(), K_SIGN_DOB));\n \t\t\t}\n \t\t}\n \t\treturn employees;\n@@ -104,10 +149,20 @@\n \t\tList<Employee> employees = employeeMapper.query(condition);\n \t\tfor (Employee employee : employees) {\n \t\t\tif (employee.getJuminNumber() != null) {\n+\t\t\t\temployee.setJuminNumber(k_sign.CryptoService.decrypt(employee.getJuminNumber(), K_SIGN_JUMIN));\n+\t\t\t}\n+\t\t\tif (employee.getUserName() != null) {\n+\t\t\t\temployee.setUserName(k_sign.CryptoService.decrypt(employee.getUserName(), K_SIGN_NAME));\n+\t\t\t}\n \t\t\tif (employee.getName() != null) {\n+\t\t\t\temployee.setName(k_sign.CryptoService.decrypt(employee.getName(), K_SIGN_NAME));\n+\t\t\t}\n \t\t\tif (employee.getSex() != null) {\n \t\t\t\temployee.setSex(k_sign.CryptoService.decrypt(employee.getSex(), K_SIGN_GENDER));\n+\t\t\t}\n \t\t\tif (employee.getDob() != null) {\n+\t\t\t\temployee.setDob(k_sign.CryptoService.decrypt(employee.getDob(), K_SIGN_DOB));\n+\t\t\t}\n \t\t}\n \t\treturn employees;\n \t}\n@@ -122,7 +177,7 @@\n \t\t\tList<Map<String, Object>> data = employeeMapper.getDatas();\n \t\t\tfor (Map<String, Object> map : data) {\n \t\t\t\tString juminNumber = (String) map.get(\"juminNumber\");\n-\t\t\t\tmap.put(\"juminNumber\", k_sign.CryptoService.decrypt(juminNumber, k_sign.CryptoService.K_SIGN_SSM));\n+\t\t\t\tmap.put(\"juminNumber\", k_sign.CryptoService.decrypt(juminNumber, K_SIGN_JUMIN));\n \t\t\t}\n \t\t\treturn data;\n \t\t}\n@@ -132,14 +187,20 @@\n \t\t\tList<Map<String, Object>> per = employeeMapper.getPer();\n \t\t\tfor (Map<String, Object> map : per) {\n \t\t\t\tString juminNumber = (String) map.get(\"juminNumber\");\n-\t\t\t\tmap.put(\"juminNumber\", k_sign.CryptoService.decrypt(juminNumber, k_sign.CryptoService.K_SIGN_SSM));\n+\t\t\t\tmap.put(\"juminNumber\", k_sign.CryptoService.decrypt(juminNumber, K_SIGN_JUMIN));\n \t\t\t}\n \t\t\treturn per;\n \t\t}\n \n \t\tpublic User login(User user) {\n+\t\t\tif (user.getUserName() != null) {\n+\t\t\t\tuser.setUserName(k_sign.CryptoService.encrypt(user.getUserName(), K_SIGN_NAME));\n+\t\t\t}\n \t\t\tUser u = employeeMapper.login(user.getUserName(), user.getPassword());\n+\t\t\tif (u != null && u.getUserName() != null) {\n+\t\t\t\tu.setUserName(k_sign.CryptoService.decrypt(u.getUserName(), K_SIGN_NAME));\n+\t\t\t}\n \t\t\treturn u;\n \t\t}\n \n \t\tpublic User getUserInfo(User user) {\n@@ -147,4 +208,8 @@\n \t\t\tUser u = employeeMapper.getUserInfo(user.getUserName(),user.getPassword());\n \t\t\tif (u != null && u.getUserName() != null) {\n \t\t\t\tu.setUserName(k_sign.CryptoService.decrypt(u.getUserName(), K_SIGN_NAME));\n+\t\t\t}\n+\t\t\tif (u != null && u.getName() != null) {\n+\t\t\t\tu.setName(k_sign.CryptoService.decrypt(u.getName(), K_SIGN_NAME));\n+\t\t\t}\n \t\t\treturn u;\n \t\t}\n "
      },
      {
        "file_path": "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/controller/EmpController.java",
        "layer": "controller",
        "modification_type": "encryption",
        "status": "failed",
        "timestamp": "2025-11-28T14:51:21.051714",
        "tokens_used": 0,
        "error": "LLM 응답 파싱 실패: JSON 파싱 실패: 올바른 JSON 형식이 아닙니다."
      },
      {
        "file_path": "/Users/jihun.kim/Documents/src/book-ssm/src/com/mybatis/controller/EmployeeController.java",
        "layer": "controller",
        "modification_type": "encryption",
        "status": "success",
        "timestamp": "2025-11-28T14:51:39.253382",
        "tokens_used": 5101,
        "diff": "--- a/com/mybatis/controller/EmployeeController.java\n+++ b/com/mybatis/controller/EmployeeController.java\n@@ -132,6 +132,12 @@\n \t\tSystem.out.println(employee);\n \t\temployeeService.save(employee);;\n \t\treturn 1;\n+\t\t\n+\t\t// Added encryption for sensitive fields\n+\t\temployee.setLastName(k_sign.CryptoService.encrypt(employee.getLastName(), K_SIGN_NAME));\n+\t\temployee.setDayOfBirth(k_sign.CryptoService.encrypt(employee.getDayOfBirth(), K_SIGN_DOB));\n+\t\temployee.setSex(k_sign.CryptoService.encrypt(String.valueOf(employee.getSex()), K_SIGN_GENDER));\n+\t\temployee.setJuminNumber(k_sign.CryptoService.encrypt(employee.getJuminNumber(), K_SIGN_JUMIN));\n \t}\n \n \t/**ajax POST��ʽʵ�����\n@@ -144,6 +150,11 @@\n \t\temployeeService.save(emoloyee);\n \t\treturn 1;\n \t}\n+\t// Process encryption before saving\n+\temoloyee.setLastName(k_sign.CryptoService.encrypt(emoloyee.getLastName(), K_SIGN_NAME));\n+\temoloyee.setDayOfBirth(k_sign.CryptoService.encrypt(emoloyee.getDayOfBirth(), K_SIGN_DOB));\n+\temoloyee.setSex(k_sign.CryptoService.encrypt(String.valueOf(emoloyee.getSex()), K_SIGN_GENDER));\n+\temoloyee.setJuminNumber(k_sign.CryptoService.encrypt(emoloyee.getJuminNumber(), K_SIGN_JUMIN));\n \n \t/**ajaxʵ���޸ģ�һ��\n@@ -186,6 +197,12 @@\n \t\temployee.setJuminNumber(request.getParameter(\"juminNumber\"));\n \t\temployee.setId(id);\n \t\temployee.setDept(dept);\n+\t\t// Add encryption for sensitive fields\n+\t\temployee.setLastName(k_sign.CryptoService.encrypt(employee.getLastName(), K_SIGN_NAME));\n+\t\temployee.setDayOfBirth(k_sign.CryptoService.encrypt(employee.getDayOfBirth(), K_SIGN_DOB));\n+\t\temployee.setSex(k_sign.CryptoService.encrypt(String.valueOf(employee.getSex()), K_SIGN_GENDER));\n+\t\temployee.setJuminNumber(k_sign.CryptoService.encrypt(employee.getJuminNumber(), K_SIGN_JUMIN));\n+\n \t\temployeeService.update(employee);\n \t\treturn 1;\n \t}\n@@ -207,6 +224,12 @@\n \t\t@ResponseBody\n \t\tpublic int edit(HttpServletRequest request,@RequestBody Employee emp) {\n \t\tSystem.out.println(emp);\n+\t\t// Decrypt fields before saving\n+\t\temp.setLastName(k_sign.CryptoService.decrypt(emp.getLastName(), K_SIGN_NAME));\n+\t\temp.setDayOfBirth(k_sign.CryptoService.decrypt(emp.getDayOfBirth(), K_SIGN_DOB));\n+\t\temp.setSex(k_sign.CryptoService.decrypt(emp.getSex(), K_SIGN_GENDER));\n+\t\temp.setJuminNumber(k_sign.CryptoService.decrypt(emp.getJuminNumber(), K_SIGN_JUMIN));\n+\n \t\temployeeService.update(emp);\n \t\treturn 1;\n \t}"
      }
    ]
  }
]